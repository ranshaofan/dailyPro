<view class="container">
  <view class="bg-decoration bg-orange"></view>
  <view class="bg-decoration bg-blue"></view>
  <view class="bg-decoration bg-rose"></view>

  <scroll-view scroll-y class="main-content">
    <view class="section-header fade-in-up delay-100">
      <view class="section-title">
        <image src="./resources/icon/time.png" mode="aspectFit" />
        <text>时间记录分类</text>
      </view>
      <view class="btn-add" hover-class="btn-hover" bind:tap="newCategory">
        <image class="icon-add" src="./resources/icon/add.png" mode="aspectFit" />
        <text>新建分类</text>
      </view>
    </view>
    <!-- <view class="tip-section fade-in-up">
      <text class="tip-text">停用的分类将不会出现在记录页。</text>
    </view> -->
    <view class="category-list">
      <block wx:for="{{categories}}" wx:key="_id">
        <view class="category-item {{item.isHidden ? 'is-disabled' : ''}} fade-in-up">

          <view class="category-icon-wrap circle" style="background-color: {{item.isHidden ? '#f1f5f9' : item.color + '20'}};">
            <view class="icon-svg {{item.class}}" style="color: {{item.isHidden ? '#cbd5e1' : item.color}};">
            </view>
          </view>

          <view class="category-info">
            <text class="category-name {{item.isHidden ? 'gray-line' : ''}}">{{item.name}}</text>

            <view class="category-count" wx:if="{{!item.isHidden}}">
              <view class="count-dot" style="background-color: {{item.color}};"></view>
              <text>{{item.count || 0}} 条记录</text>
            </view>
            <text class="category-status" wx:else>已隐藏</text>
          </view>

          <view class="category-actions">
            <view class="action-btn" hover-class="btn-hover" bindtap="onEdit" data-id="{{item._id}}">
              <image class="action-icon" src="./resources/icon/edit.png" />
            </view>
            <view class="check-toggle {{item.isHidden ? 'is-hidden' : 'is-active'}}" bindtap="toggleStatus" data-id="{{item._id}}" style="background-color: {{item.isHidden ? 'transparent' : item.color}}; border-color: {{item.isHidden ? '#e2e8f0' : item.color}};">
              <icon wx:if="{{!item.isHidden}}" type="success_no_circle" size="14" color="#ffffff" />
            </view>
          </view>
        </view>
      </block>
    </view>

    <view class="divider fade-in-up delay-300"></view>

    <view class="section-header fade-in-up delay-300">
      <view class="section-title">
        <image src="./resources/icon/slot.png" mode="aspectFit" />
        <text>今日打卡内容</text>
      </view>
      <view class="btn-add" hover-class="btn-hover" bind:tap="newFlag">
        <image class="icon-add" src="./resources/icon/add.png" mode="aspectFit" />
        <text>新增打卡</text>
      </view>
    </view>

    <view class="category-list">
      <block wx:for="{{checkItems}}" wx:key="_id">
        <view class="category-item fade-in-up">
          <view class="category-icon-wrap bg-warm-soft">
            <image class="category-img" src="../common/img/{{item.iconName}}.png" mode="aspectFit" />
          </view>

          <view class="category-info">
            <text class="category-name">{{item.name}}</text>
            <view class="category-count">
              <!-- <image class="mini-icon-img" src="./resources/icon/check_warm.png" /> -->
              <text class="warm-subtext">{{item.subTitle}}</text>
            </view>
          </view>

          <view class="category-actions">
            <view class="action-btn" hover-class="btn-hover" bindtap="onCheckEdit" data-id="{{item._id}}">
              <image class="action-icon" src="./resources/icon/edit.png" mode="aspectFit" />
            </view>
            <view class="switch-wrap" bindtap="onToggleCheck" data-id="{{item._id}}">
              <view class="switch-bg theme-switch {{item.isOpen ? 'on' : 'off'}}">
                <view class="switch-dot"></view>
              </view>
            </view>
          </view>
        </view>
      </block>
    </view>
  </scroll-view>
</view>

<!-- 分类弹窗 -->
<view class="modal-mask {{show ? 'show' : ''}}" bindtap="onCancel">
  <view class="modal-container {{show ? 'enter' : ''}}" catchtap="preventBubble">
    <view class="drag-bar-wrap">
      <view class="drag-bar"></view>
    </view>
    <view class="modal-header">
      <view class="btn-cancel" hover-class="btn-hover" bindtap="onCancel">取消</view>
      <text class="modal-title">{{isEdit ? '编辑分类' : '新建分类'}}</text>
      <view class="btn-save" hover-class="btn-hover" bindtap="onSave">保存</view>
    </view>

    <view scroll-y class="modal-content">
      <view class="input-section">
        <view class="input-card">
          <!-- <view class="icon-preview" style="background-color: {{selectedColor}}">
            <view class="icon-svg {{selectedIcon}}"></view>
          </view> -->
          <view class="category-icon-wrap circle" style="background-color: {{selectedColor + '20'}}; border: 1px solid {{selectedColor}}40;">
            <view class="icon-svg {{selectedIcon}}" style="color: {{selectedColor}};">
            </view>
          </view>
          <input class="name-input" placeholder="例如：阅读、健身..." value="{{categoryName}}" bindinput="onInputName" />
          <view class="btn-clear" wx:if="{{categoryName}}" bindtap="onClear">
            <icon type="clear" size="20" color="#8a8a8a"></icon>
          </view>
        </view>
      </view>

      <view class="section-group">
        <view class="section-label">选择图标</view>
        <view class="grid-container card">
          <block wx:for="{{icons}}" wx:key="name">
            <view class="grid-item {{selectedIcon === item.class ? 'active' : ''}}" bindtap="selectIcon" data-icon="{{item.class}}" 
            style="color: {{selectedIcon === item.class ? selectedColor : '#8a8a8a'}};">
              <view class="icon-svg {{item.class}}"></view>
            </view>
          </block>
        </view>
      </view>

      <view class="section-group">
        <view class="section-label">主题色调</view>
        <view class="color-container card">
          <block wx:for="{{colors}}" wx:key="*this">
            <view class="color-item {{selectedColor === item ? 'active' : ''}}" style="background-color: {{item}}" bindtap="selectColor" data-color="{{item}}">
              <view class="check-mark" wx:if="{{selectedColor === item}}">L</view>
            </view>
          </block>
        </view>
      </view>

      <view class="delete-section" wx:if="{{isEdit}}">
        <view class="btn-delete" hover-class="btn-delete-hover" bindtap="onDelete">
          <!-- <image src="./resources/icon/delete.png" class="icon-delete" /> -->
          <text>删除该分类</text>
        </view>
        <view class="delete-tip">删除后，该分类下的历史记录不会被移除。</view>
      </view>

      <view class="safe-area-inset"></view>
    </view>
  </view>
</view>
<!-- 打卡弹窗 -->
<view class="modal-mask {{showCheckModal ? 'show' : ''}}" bindtap="onCheckCancel">
  <view class="modal-container check-modal-style {{showCheckModal ? 'enter' : ''}}" catchtap="preventBubble">
    <view class="drag-bar-wrap">
      <view class="drag-bar"></view>
    </view>

    <view class="modal-header">
      <view class="btn-cancel" hover-class="btn-hover" bindtap="onCheckCancel">取消</view>
      <text class="modal-title">{{isEditCheck ? '编辑打卡' : '新增打卡'}}</text>
      <view class="btn-save" hover-class="btn-hover" bindtap="onCheckSave">保存</view>
    </view>

    <view class="modal-content">
      <view class="input-section">
        <view class="input-card flex-start">
          <view class="image-preview">
            <image src="../common/img/{{selectedCheckIcon}}.png" mode="aspectFill" class="check-icon-img" />
          </view>
          <input class="content-textarea" placeholder="请输入打卡内容..." value="{{checkContent}}" bindinput="onInputContent" />
        </view>
      </view>

      <view class="section-group">
        <view class="section-label">打卡图标</view>
        <view class="grid-container check-grid card">
          <block wx:for="{{checkIcons}}" wx:key="*this">
            <view class="grid-item {{selectedCheckIcon === item ? 'active' : ''}}" bindtap="selectCheckIcon" data-url="{{item}}">
              <image src="../common/img/{{item}}.png" mode="aspectFit" class="grid-icon-img" />
            </view>
          </block>
        </view>
      </view>

      <view class="delete-section" wx:if="{{isEditCheck}}">
        <view class="btn-delete" hover-class="btn-delete-hover" bindtap="onDeleteCheck">
          <text>删除此打卡</text>
        </view>
        <view class="delete-tip">删除后，过往打卡记录依然保留</view>
      </view>

      <view class="safe-area-inset"></view>
    </view>
  </view>
</view>