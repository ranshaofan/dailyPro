<!--page/index/index.wxml-->
<view class="container">
  <view class="header">
    <view class="header-top">
      <view class="date-info">
        <view class="title-row">
          <text class="title-main">今天</text>
          <text class="title-sub">{{today}}</text>
        </view>
        <view class="status-badge">
          <text class="icon-small">☀️</text>
          <text>Daily Flow</text>
        </view>
      </view>
      <view class="icon-button shadow-card">
        <image src="./resources/pic/{{helloPic}}.png" mode="widthFix"></image>
      </view>
    </view>

    <view class="stats-card shadow-card">
      <view class="stat-item">
        <text class="stat-value">4</text>
        <text class="stat-label">记录片段</text>
      </view>
      <view class="divider-v"></view>
      <view class="stat-item">
        <text class="stat-value">6.5</text>
        <text class="stat-label">专注时长</text>
      </view>
    </view>
  </view>
  <view class="status-section">
    <text class="section-label">今日打卡</text>
    <scroll-view scroll-x class="status-tags-scroll" enable-flex>
      <block wx:for="{{checkItems}}" wx:key="flagId">
        <view class="status-tag {{item.isOpen ? 'active' : 'normal'}}" bindtap="onToggleStatus" data-id="{{item.flagId}}">
          <image class="tag-icon-img" src="../common/img/{{item.iconName}}.png" mode="aspectFit" />

          <view class="tag-text">
            <text class="tag-title">{{item.name}}</text>
            <text wx:if="{{item.isOpen}}" class="tag-desc">已完成打卡</text>
          </view>
        </view>
      </block>

      <view wx:if="{{checkItems.length === 0}}" class="empty-tips">
        <text>今日暂无打卡项</text>
      </view>
    </scroll-view>
  </view>
  <scroll-view scroll-y class="content-scroll">
    <view class="timeline-main">
      <view class="timeline-line"></view>

      <view class="timeline-item">
        <view class="timeline-icon-wrap">
          <view class="timeline-icon bg-orange">
            <text class="material-icons text-orange">directions_car</text>
          </view>
        </view>
        <view class="event-card shadow-card">
          <view class="card-header">
            <text class="time-range">08:00 - 09:00</text>
            <view class="category-badge bg-orange-soft">
              <view class="dot bg-orange"></view>
              <text>生活</text>
            </view>
          </view>
          <text class="event-title">交通通勤</text>
          <text class="event-desc">听播客：设计心理学第二章，关于用户体验的思考。</text>
        </view>
      </view>

      <view class="timeline-item">
        <view class="timeline-dot-wrap">
          <view class="timeline-dot-small"></view>
        </view>
        <view class="gap-button">
          <view class="gap-info">
            <view class="gap-header">
              <text class="time-range">09:00 - 09:30</text>
              <text class="gap-label">空闲</text>
            </view>
            <text class="gap-action">补记这段时间</text>
          </view>
          <text class="material-icons add-icon">add_circle</text>
        </view>
      </view>

      <view class="timeline-item">
        <view class="timeline-icon-wrap">
          <view class="timeline-icon bg-blue">
            <text class="material-icons text-blue">laptop_mac</text>
          </view>
        </view>
        <view class="event-card shadow-card">
          <view class="card-header">
            <text class="time-range">09:30 - 12:00</text>
            <view class="category-badge bg-blue-soft">
              <view class="dot bg-blue"></view>
              <text>工作</text>
            </view>
          </view>
          <text class="event-title">深度工作：产品设计</text>
          <view class="tag-container">
            <text class="mini-tag">#项目开发</text>
            <text class="mini-tag">#UI视觉</text>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>

  <view class="bottom-action-container">
    <view class="input-main-part">
      <view class="input-toggle" bindtap="toggleInputMode">
        <text class="material-icons {{inputMode === 'voice' ? 'icon-keyboard' : 'icon-voice'}}"></text>
      </view>

      <view class="divider-line"></view>

      <view class="main-input-area">
        <view wx:if="{{inputMode === 'voice'}}" class="voice-btn-flat {{isRecording ? 'active-tap' : ''}}" bindtouchstart="startRecording" bindtouchend="stopRecording">
          <text class="material-icons icon-voice" style="font-size: 36rpx; margin-right: 8rpx;"></text>
          <text>按住说话</text>
        </view>

        <view wx:else class="text-input-wrap-flat">
          <input class="input-box" placeholder="记录此刻..." focus="{{inputMode === 'text'}}" bindconfirm="sendText" />
          <view class="send-icon" bindtap="sendText">
            <text class="material-icons icon-send" style="font-size: 40rpx;"></text>
          </view>
        </view>
      </view>
    </view>

    <view class="standalone-add-btn" bindtap="onAddTimeline">
      <text class="material-icons icon-add"></text>
    </view>
  </view>
</view>
<!-- 弹窗 -->
<view class="modal-mask {{showModal ? 'show' : ''}}" bindtap="hideModal">
  <view class="modal-content" catchtap="stopBubble">
    
    <view class="modal-handle"></view>

    <view class="modal-header">
      <text class="modal-title">确认内容</text>
      <view class="close-btn" bindtap="hideModal">
        <text class="icon-close">close</text>
      </view>
    </view>

    <scroll-view scroll-y class="modal-body">
      <view class="info-section">
        <view class="section-row">
          <text class="section-label">时间段</text>
          <text class="section-label">分类</text>
        </view>
        <view class="info-cards">
          <view class="time-card">
            <view class="time-box">
              <text class="time-val">14:00</text>
              <!-- <image class="arrow-icon" src="/assets/arrow_right.png" mode="aspectFit"></image> -->
              <text class="time-val">14:45</text>
            </view>
          </view>
          <view class="category-tag-large">
            <text class="material-icons" style="font-size: 32rpx;">school</text>
            <text>学习</text>
          </view>
        </view>
      </view>

      <view class="content-section">
        <text class="section-label">记录内容</text>
        <view class="text-area-container">
          <textarea 
            class="content-textarea" 
            value="阅读《简约至上》，整理关于交互设计的笔记，思考如何简化用户流程。" 
            maxlength="500" 
            auto-height
          />
          <view class="textarea-footer">
            <view class="word-count">28 字</view>
            <view class="mic-circle">
              <text class="icon-voice"></text>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>

    <view class="modal-footer">
      <view class="delete-btn">
        <text class="icon-del"></text>
      </view>
      <view class="confirm-btn">
        <text class="material-icons" style="margin-right: 12rpx;">check_circle</text>
        <text>完成</text>
      </view>
    </view>
  </view>
</view>